<!DOCTYPE html>
<!--
################################################################################
### COPYRIGHT ##################################################################

# New York Genome Center

# SOFTWARE COPYRIGHT NOTICE AGREEMENT
# This software and its documentation are copyright (2023) by the New York
# Genome Center. All rights are reserved. This software is supplied without
# any warranty or guaranteed support whatsoever. The New York Genome Center
# cannot be responsible for its use, misuse, or functionality.

# Author: Timothy R. Chu 

################################################################# /COPYRIGHT ###
################################################################################
## Figure 2B - Oncoprint 
-->
<html>    
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/skeleton/2.0.4/skeleton.css">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <style>
        #chart {
            position: fixed;
            left: 0px;
            right: 0px;
            top: 0px;
            bottom: 0px;
            z-index: -2;
            height: 100%;
        }
        #options{
            margin-bottom:10px; 
            border-radius: 5px;
            padding: 10px;
            background-color: #FFEFD5;
        }
        body {
            font-family: sans-serif
        }
        div.tooltip {
            position: absolute;
            text-align: left;
            width: auto;
            height: auto;
            padding: 5px;
            border-width: 1px;
            border-radius: 2px;
            pointer-events: none;
            font-family: sans-serif;
            font-size: 13px;
            border: 2px solid white;
        }
        input{
            margin-bottom: 0.5rem;
            height: 25px !important;
        }
        button{
            padding-left: 10px;
            padding-right: 10px;
            background-color: white;
        }
    
    </style>
  </head>
  <body>
    <div id="options" class="row">
        <div class="three columns">
            <div class="row">
                <b>Add Gene:</b>
                <br>
                <textarea list="addGeneList" placeholder="e.g. TP53" id='addGeneInput' style="margin-bottom:0"></textarea>
                <datalist id="addGeneList">
                </datalist>
            </div>
            <button type="button" id="addGeneButton">Add</button><button type="button" id="removeAllButton" style="margin-left:10px">Remove All</button>
            <div style="font-size:10px;">Also supports comma-separated or newline-separated list of multiple genes</div>
            
            <div id='no_variants_error' style="font-size:10px; color:red; opacity:0">No variants found for this gene.</div>
            <input type="checkbox" id="toggleFocal"/>Toggle Largescale CNV
        </div>
        <div class="five columns">
            <div class="row">
                <b id="groupByDesc">Group by:</b>
                <br>
                <select id="groupByList">
                </select> Split Groups: <input type="checkbox" id="splitGroups">
                <br>
                <b id="rankByDesc">Rank by:</b>
                <br>
                <select id="rankByList">
                    <option value="All">All</option>
                </select> 
                <br>
                <b id=sortByDesc>Sort by:</b>
                <br>
                <select id="sortByList">
                    <option value="max">Max score</option>
                    <option value="avg">Average score</option>
                </select>
            </div>
        </div>
    </div>
    <div id="chart">
    </div>
    
    <script>
        var chartDiv = document.getElementById("chart");
        var width = chartDiv.clientWidth -20;
        var height = chartDiv.clientHeight -20;

        var x = d3.scaleLinear().range([0,width]).domain([0,1000])
        var y = d3.scaleLinear().range([0,height-150]).domain([0,1000])
        var scale = d3.scaleLinear().range([0,height]).domain([0,1000])
        
        var attr = ['HIGH','MODERATE','amplification','gain','deletion','loss']
        var attrColors = ['black','#f8b946','#982f2f','#f85252','#3573fd','#00308b']
        var colorScale = d3.scaleOrdinal().range(attrColors).domain(attr)
        
        var div = d3.select("body").append("div")
        .attr("class", "tooltip")
        .attr("font-size",scale(60))
        .style("opacity", 0);

        var svg = d3.select("body").append("svg")
            .attr("width", 3000)
            .attr("height", 4000)
        
        var cellWidth = 20
        var cellHeight = 40
        var cellPadding = 2
        var metadataHeight = 20
        var xAxistextSize = 12
        var yAxistextSize = 15
        var yAxisWidth = 10 //by default. will be changed
        var thresh_highamp = 2
        var thresh_amp = 1
        var thresh_del = -1
        var thresh_deepdel = -2

        var isFocal = true
        
        var groupBy = d3.select('#groupByList')
        var rankBy = d3.select('#rankByList')
        var sortBy = d3.select('#sortByList')
        var toggleFocal = d3.select("#toggleFocal")
        var splitGroups = d3.select('#splitGroups')
        
        var chrXY_geneList = ["AL954722.1","PLCXD1","GTPBP6","LINC00685","PPP2R3B","AL732314.6","RF00017","AL732314.4","FABP5P13","KRT18P53","SHOX","AL672277.1","RPL14P5","CRLF2","CSF2RA","MIR3690","RNA5SP498","IL3RA","SLC25A6","LINC00106","ASMTL-AS1","ASMTL","P2RY8","AKAP17A","ASMT","AL683807.1","AL683807.2","DHRSX","DHRSX-IT1","ZBED1","MIR6089","CD99P1","LINC00102","CD99","XG","GYG2","GYG2-AS1","ARSD","ARSD-AS1","ARSE","ARSH","ARSF","RN7SL578P","AC112653.1","LINC01546","MXRA5","ASS1P4","SNORA48B","RNU6-114P","PRKX","RNU6-146P","RF00019","PRKX-AS1","AC007685.1","BX890604.1","FAM239A","FAM239B","FAM239C","BX890604.2","AC074035.1","MTND6P12","MTCYBP12","AC112656.1","RF00401","AC110995.1","NLGN4X","RF00322","MIR4770","AC078991.1","VCX3A","AC097347.1","RPS27AP17","PUDP","AC073583.1","MIR4767","STS","AC120338.1","VCX","AC005296.1","PNPLA4","AC078960.1","MIR651","VCX2","VCX3B","ANOS1","DRAXINP1","FAM9A","AC003685.2","AC003685.1","AC074281.1","FAM9B","RNA5SP499","AC119618.1","AC003684.1","AC073488.1","AC073488.7","AC073488.9","AC073488.8","AC073488.10","AC073488.5","AC073488.11","AC073488.4","AC073488.3","AC073488.2","AC073488.6","TBL1X","GPR143","SHROOM2","EIF5P1","HMGN1P33","RF00019","CLDN34","WWC3","WWC3-AS1","RF00019","CLCN4","AC003666.1","MID1","RNU6-800P","AC073529.1","HCCS","RF00019","ARHGAP6","RF02271","AC004467.1","AMELX","MIR548AX","AC002366.1","AC004554.2","AC004554.1","MSL3","RF00019","FRMPD4","RF00019","FRMPD4-AS1","RPL17P49","AC119619.1","RN7SKP290","PRPS2","PSMA6P2","MRPL35P4","TLR7","TLR8-AS1","TLR8","TMSB4X","FAM9C","AC079171.1","LINC02154","AC004674.1","ATXN3L","AC004674.2","LINC01203","AC135371.1","GPX1P1","EGFL6","RPL30P15","MIR6086","RN7SKP20","TCEANC","RAB9A","TRAPPC2","OFD1","GPM6B","AC003035.2","AC003035.1","GEMIN8","AC002524.1","GLRA2","NPM1P9","FANCB","MOSPD2","TPT1P14","AC112498.1","ASB9","ASB11","PIGA","VEGFD","PIR","BMX","ACE2","AC097625.1","CLTRN","AC003669.1","CA5BP1","CA5B","AC112497.1","RF00409","INE2","ZRSR2","AP1S2","RNU5F-7P","SETP15","GRPR","AC078993.1","MAGEB17","RPL6P30","AC073909.1","RN7SL658P","CTPS2","MIR548AM","S100G","SYAP1","RNU7-56P","TXLNG","RPL12P49","RBBP7","RNU4-6P","AL929302.1","RF00019","REPS2","RF00190","CBX1P2","CBX1P4","RF01210","NHS","MIR4768","Z93022.1","NHS-AS1","Z93242.1","SCML1","Z93242.2","RAI2","Z93929.2","Z93929.1","LINC01456","BEND2","SCML2","TMSB10P2","RF00019","CDKL5","GJA6P","RS1","PPEF1","PPEF1-AS1","AL096700.1","HAUS1P2","PHKA2-AS1","PHKA2","RN7SL48P","ADGRG2","PDHA1","MAP3K15","RF00019","EIF5P2","SH3KBP1","BCLAF3","RF00019","MAP7D2","MIR23C","EIF1AX","RF00493","RF00494","EIF1AX-AS1","RPS6KA3","AL928596.1","AL807740.1","RN7SKP183","AL807742.1","BX088723.1","RNU6-133P","CNKSR2","RARRES2P3","KLHL34","SMPX","MBTPS2","U73479.1","YY2","RF00019","U73023.1","SMS","PHEX","PHEX-AS1","PTCHD1-AS","CBLL2","AC092832.2","METTL15P3","RNU6-266P","AC092832.1","AC004470.1","DDX53","FAM3C2","PDCL2P1","PTCHD1","AC073910.1","PRDX4","ACOT9","AC131011.1","RF00019","SAT1","APOO","RPL9P7","CXorf58","KLHL15","EIF2S3","RF00263","ZFX-AS1","ZFX","SUPT20HL2","SUPT20HL1","AC004552.1","PDK3","SNRPEP9","AC004656.1","PCYT1B","AC079168.1","PCYT1B-AS1","AC079168.2","POLA1","SCARNA23","EEF1B2P3","ARX","AC002504.1","RN7SL91P","AC112778.1","RPP40P1","AC097263.1","AC121342.1","MAGEB18","AC129850.1","MAGEB6B","AC005297.1","MAGEB6","AC005297.2","MAGEB5","AC005297.3","AC073614.1","AC079178.2","AC079178.1","VENTXP1","AC005345.1","RPL7P58","HMGA1P1","RNU1-142P","AC112493.1","AC107419.1","AC097262.1","RF00019","PTP4A1P5","PPP4R3C","AC006210.1","AC006210.2","DCAF8L2","MAGEB10","AC107613.1","AC112492.2","AC112492.4","AC112492.3","AC112492.5","AC112492.1","DCAF8L1","MIR6134","AC112495.1","IL1RAPL1","AC002367.1","RF00284","AC003659.1","RNA5SP500","AL031575.1","MIR4666B","PIGFP3","AC005185.1","MAGEB2","MAGEB3","MAGEB4","MAGEB1","PLCE1P1","NR0B1","CXorf21","CKS1BP6","FTLP2","GK","GK-IT1","AC112496.1","GK-AS1","AC108359.1","TAB3","TAB3-AS1","TAB3-AS2","FTHL17","DMD","RNU6-894P","RNA5SP501","NPM1P8","MIR3915","MIR548F5","DMD-AS3","TBCAP1","AL050305.1","AL591501.1","FAM47A","FTH1P14","AL592043.1","AL592043.2","AL592504.1","TMEM47","AL606662.1","AL596245.1","FAM47B","AL596268.1","RNU6-1087P","SIAH1P1","AL161722.1","AL161722.3","AL161722.2","MAGEB16","AL590065.1","CFAP47","RNU6-641P","HMGB1P16","AL606516.1","RPS15AP40","AL592156.1","AC006924.1","BX842568.4","BX842568.2","BX842568.3","FAM47C","FTH1P18","BX842568.1","MOB1AP2","PRRG1","AF241726.2","AC245096.1","FTH1P19","FTH1P27","FAM47DP","LANCL3","XK","CYBB","DYNLT3","RNU6-49P","AL121578.3","AL121578.1","HYPM","AL121578.2","SYTL5","MIR548AJ2","SRPX","AL606748.1","RPGR","RF00322","OTC","TDGF1P1","AF241726.1","FTLP16","UBTFL11","TSPAN7","RNU7-7P","AF241728.1","MID1IP1","MID1IP1-AS1","RNU6-591P","AC108879.1","LINC01281","LINC01282","AC091808.1","MIR3937","RN7SL732P","GAPDHP1","AC091810.1","AL592164.1","MIR1587","RPS11P7","AC092198.1","BCOR","AC091806.1","AC091807.1","RF00019","AC092473.1","RNU7-164P","ATP6AP2","MPC1L","CXorf38","MED14","MED14OS","DPRXP6","AC092474.1","AC092474.2","MKRN4P","SDCBPP3","AC092268.1","RPS2P55","CLIC4P3","USP9X","AL109797.1","RNA5SP502","RF00019","AL391647.1","DDX3X","RN7SL15P","NYX","Z93015.1","CASK","CASK-AS1","RNU6-1321P","AL627402.1","RN7SL144P","GPR34","GPR82","AL353691.1","AL353691.2","RNU6-202P","AL133329.1","ATP5MC2P4","RNU6-630P","Z92545.1","RNU6-1124P","Z93403.1","AL023875.1","PPP1R2C","AL451086.1","PINCR","IMPDH1P4","NANOGP10","MAOA","MAOB","NDP","NDP-AS1","AL034370.1","EFHC2","TATDN2P1","RRM2P3","RF00019","AL022163.1","FDPSP5","FUNDC1","CHTF8P1","RPL19P20","RPSAP61","RN7SL291P","DUSP21","KDM6A","CXorf36","AC136489.1","AL020989.1","LINC01204","KRT8P14","AC234772.1","MIR222HG","MIR221","MIR222","AC234772.3","AC234772.2","RF00591","AL031584.1","AL031584.2","MED28P4","KRT18P68","PCNAP3","RF00017","ACTBP1","LINC01186","AL139811.2","GAPDHP65","KRBOX4","AL139811.1","ZNF674","RNU6-50P","ZNF674-AS1","RF00017","MKI67P1","CHST7","SLC9A7","PGAM1P7","YBX1P8","AL512633.1","RP2","LINC01545","JADE3","RGN","RNU6-1189P","RNU12-2P","NDUFB11","RBM10","AL513366.1","UBA1","INE1","CDK16","USP11","AL591503.3","RN7SL785P","AL591503.1","ZNF157","SNORA11C","AL591503.2","NPM1P49","ZNF41","RF00017","LINC01560","NUS1P1","ARAF","SYN1","TIMP1","MIR4769","AL009172.2","CFP","ELK1","UXT","UXT-AS1","CXXC1P1","AL009172.1","AL022578.1","WASF4P","ZNF81","RPL7P57","ZNF182","ZNF630","SPACA5","ZNF630-AS1","SSX6","SPACA5B","AC244636.1","AC244636.2","RNU6-707P","SSXP3","AC245047.7","SSX5","AC245047.5","RNA5SP503","AC245047.1","AC245047.3","AC245047.2","SSX1","AC245047.4","AC245047.8","AC245047.6","SSX9","AL606490.6","SSXP9","AL606490.3","AL606490.9","SSX3","AL606490.1","AL606490.7","SSX4","SSX4B","AL606490.5","AL606490.4","AL606490.8","AL606490.2","SLC38A5","FTSJ1","AF196972.1","PORCN","EBP","RF00017","TBC1D25","AC115618.1","RBM3","AC115618.2","AC115618.3","MRPL32P1","WDR13","VN1R110P","WAS","SUV39H1","AC231533.1","RNU6-1056P","GLOD5","AC231533.2","RNU6-29P","GATA1","HDAC6","ERAS","PCSK1N","TIMM17B","PQBP1","SLC35A2","PIM2","OTUD5","AC233300.1","RNU6-722P","KCND1","GRIPAP1","TFE3","CCDC120","PRAF2","WDR45","RNU4-52P","GPKOW","RN7SL262P","AC231657.2","MAGIX","AC231657.1","PLP2","PRICKLE3","SYP","SYP-AS1","CACNA1F","HSPB1P2","CCDC22","FOXP3","PPP1R3F","AC232271.1","GAGE10","GAGE12J","GAGE13","GAGE2E","GAGE12B","GAGE12C","GAGE12D","GAGE12F","GAGE12E","GAGE12G","GAGE12H","GAGE1","GAGE2A","VDAC1P2","SALL1P1","PAGE1","PAGE4","USP27X-AS1","USP27X","AC236430.1","CLCN5","RNU6-421P","MIR532","MIR188","MIR500A","MIR362","MIR501","MIR500B","MIR660","MIR502","PYY3","RF00019","AKAP4","CCNB3","DGKK","SHROOM4","RNU6-935P","H3F3AP5","BMP15","HMGB1P15","AC239367.1","AC239367.2","LINC01284","AC239367.3","NUDT10","AC233976.1","AL158055.1","CXorf67","NUDT11","LINC01496","CENPVL3","CENPVL2","CENPVL1","GSPT2","MAGED1","AC241520.1","RNU6-504P","AL929410.1","IPO7P1","AL929410.2","TPMTP3","AC239585.1","AC239585.2","MAGED4B","SNORA11E","MAGED4","SNORA11D","AC245177.1","AC231759.1","MIR8088","XAGE2","AC231532.1","AC231532.2","BX510359.1","BX510359.5","BX510359.8","BX510359.7","RBM22P6","XAGE1A","RBM22P7","XAGE1B","BX510359.6","BX510359.2","BX510359.4","BX510359.3","SSXP4","SSXP1","AL450023.2","SSX8","SSX7","AL450023.1","RNA5SP504","SSXP5","AL450023.3","SSX2","AC244505.2","AC244505.3","AC244505.5","SSX2B","AC244505.7","AC244505.4","SPANXN5","AC244505.6","XAGE5","AC244505.1","EIF4A2P4","XAGE3","FAM156B","FAM156A","GPR173","BX322635.1","TSPYL2","AL591212.1","KANTR","AL591212.2","ACTG1P10","AL139396.1","KDM5C","MIR6895","MIR6894","KDM5C-IT1","IQSEC2","RPSAP62","RF00019","AC245102.2","AC245102.1","SMC1A","MIR6857","RIBC1","HSD17B10","AC233728.1","AC233728.2","VTRNA3-1P","HUWE1","MIR98","MIRLET7F2","BX323845.1","BX323845.2","BX323845.3","AC233279.1","RNA5SP505","PHF8","FAM120C","AL589872.1","WNK3","RPL7AP71","RNU6-434P","TSR2","FGD1","GNL3L","PGAM4P1","ITIH6","MAGED2","SNORA11","AL049732.1","TRO","RF00614","PFKFB1","APEX2","ALAS2","AL020991.1","AL590240.2","PAGE2B","PAGE2","AL590240.4","AL590240.3","FAM104B","AL590240.1","MTCO1P52","MTND2P24","MTND1P30","MTRNR2L10","PAGE5","PAGE3","AL158819.1","MIR4536-1","MIR4536-2","MAGEH1","USP51","AL590410.1","RF00019","AL627224.1","FOXR2","AL159987.2","AL159987.1","RRAGB","AL445472.1","AL391419.1","KLF8","RPL23AP83","UBQLN2","AL354793.1","NBDY","UQCRBP1","SPIN3","AL139397.1","AL139397.2","SPIN2B","AL022157.1","SPIN2A","PPP1R11P2","FAAH2","MTHFD1P1","ZXDB","NLRP2B","Z93019.1","ZXDA","MYCLP2","KRT8P17","BX322784.1","MTND1P31","MTND2P25","ZFRP1","AL359854.1","CBX1P1","LINC01278","SPIN4","SPIN4-AS1","ARHGEF9","ARHGEF9-IT1","BTF3P8","MIR1468","HNRNPDP1","AL355852.1","AMER1","RN7SL799P","ASB12","MTMR8","AL356317.1","PFN5P","SHC1P1","YWHAZP7","KRT8P27","GRPEL2P2","BLOC1S2P1","ZC4H2","AL445523.1","CCT4P2","MORF4L1P5","AL441964.1","ZC3H12B","TLE1P1","Z83841.1","LAS1L","FRMD8P1","MSN","NANOGP9","AL450487.2","ETF1P3","AL450487.1","AL034397.1","AL034397.2","AL034397.3","MIR223","VSIG4","AL139276.1","EIF4BP9","HEPH","AL157698.1","AL592049.1","PKMP2","EDA2R","RNU6-394P","AL049641.1","AL049564.1","AR","BMI1P1","AL157700.1","OPHN1","AL158201.1","RNU6-1225P","AKIRIN1P2","RF00019","AL672138.1","YIPF6","RNU6-245P","RPL31P63","COX6CP12","STARD8","ACTR3P2","SERBP1P1","EFNB1","PJA1","HMGN1P35","LINC00269","CYCSP43","FAM155B","AL158069.1","EDA","RNA5SP506","RF00012","CNOT7P1","MIR676","AWAT2","OTUD6A","MTCYBP31","MTND4P31","IGBP1","IGBP1-AS2","IGBP1-AS1","DGAT2L6","RN7SL581P","AWAT1","RNA5SP507","P2RY4","ARR3","RAB41","PDZD11","KIF4A","AL357752.1","RNY4P23","GDPD2","AL139398.1","DLG3","RNU4-81P","DLG3-AS1","TEX11","AL139109.1","SNORD3E","AL627390.1","SLC7A3","RPS23P8","NUTF2P7","RNU1-56P","SOCS5P4","SNX12","FOXO4","CXorf65","AL590764.2","IL2RG","MED12","NLGN3","AL590764.1","GJB1","ZMYM3","NONO","ITGB1BP2","AL590762.3","AL590762.2","TAF1","RF00017","AL590762.4","AL590762.1","RF00019","INGX","AL590763.1","OGT","GCNA","CXCR3","BX276092.7","BX276092.9","BX276092.4","LINC00891","CXorf49","BX276092.2","BX276092.6","BX276092.8","BX276092.5","CXorf49B","BX276092.1","BX276092.3","BX119927.1","NHSL2","RNU6-1078P","RPS26P11","RTL5","BX119917.1","PIN4","RN7SL388P","ERCC6L","RPS4X","RF00019","CITED1","HDAC8","RNU2-68P","PHKA1","BX295541.1","PHKA1-AS1","RF00012","AC240504.1","RNU1-112P","DMRTC1B","FAM226B","FAM236B","FAM236D","DMRTC1","FAM236C","FAM236A","PABPC1L2B-AS1","PABPC1L2B","PABPC1L2A","AL662864.1","NAP1L6","NAP1L2","TOMM20P4","AC004074.1","YWHAZP8","RNU6-1044P","CDX4","MORF4L1P6","MAP2K4P1","RPL7P53","CHIC1","SEPHS1P4","TSIX","XIST","RF02266","RF01881","RF01880","FXYD6P3","JPX","RF02124","RF02125","FTX","AL353804.1","AL353804.2","RPSAP14","AL139400.1","AL627389.1","UHRF2P1","DDX3P1","AL359740.1","DDX3P2","MKRN5P","ATP5MDP1","BMP2KL","RAB11FIP1P1","Z83843.1","MIR421","MIR374B","MIR374C","RN7SL648P","RF02119","RF02120","RF02121","RF02123","MIR545","MIR374A","RF02122","ZCCHC13","AC004386.2","AC004386.1","RN7SL790P","THAP12P1","RPS7P14","SLC16A2","HNRNPA1P25","PABPC1P3","RLIM","RNU6-330P","NEXMIF","AL139395.1","ABCB7","BUD31P2","RNU6-562P","UPRT","AL137013.1","ZDHHC15","RPL21P134","PCNPP4","BRAFP1","TTC3P1","MAGEE2","SAR1AP4","AL451105.1","AL451105.2","AC233982.1","PBDC1","AC233981.1","RNU6-867P","AC233981.2","LDHBP2","MAGEE1","RNA5SP508","TRAPPC13P1","AC233296.1","MIR384","MIR325","RNA5SP509","SPRYD7P1","FGF16","ATRX","FABP5P15","MAGT1","RNU6-854P","RN7SL460P","COX7B","ATP7A","PGK1","AL356235.1","PGAM4","TAF9B","FNDC3CP","CYSLTR1","HMGN1P34","UBE2V1P7","RTL3","PPATP2","LPAR4","RPL7P54","MIR4328","P2RY10","P2RY10BP","GPR174","CTHRC1P1","KIF4CP","ITM2A","AL009028.1","TBX22","CHMP1B2P","TENT5D","HNRNPH3P1","AL512504.2","HK2P1","BRWD3","AL512504.1","RF01225","RNU6-493P","VDAC1P1","RNU6-995P","AL391294.1","HMGN5","SH3BGRL","AL359885.1","AL445213.1","AL691517.1","RNU6-974P","AL031313.1","RPL22P22","RF00394","AL008987.1","ATG4AP1","Z82170.1","POU3F4","AL121882.1","TERF1P4","CYLC1","RPS6KA6","MIR548I4","HDX","AL450471.1","SETP4","UBE2DNL","Z83820.1","APOOL","SATL1","Z99571.1","AC003001.2","AC003001.1","ZNF711","POF1B","MIR1321","SFR1P2","AL022401.1","CHM","MIR361","RF00019","NDUFA5P7","STIP1P3","TPMTP4","DACH2","EEF1A1P29","GEMIN8P3","RF00026","FCF1P9","AL390058.1","Z82210.1","AL590229.1","RF00279","Z96811.1","KLHL4","RPSAP15","Z83818.2","Z83818.1","AL136363.1","AL136363.2","AL035246.1","AL024493.1","RF01225","AL929325.1","CPXCR1","AL022154.1","AL645638.1","AL731768.1","SRIP2","AL121872.1","TGIF2LX","AL121877.1","USP12PX","AL121873.1","RNF19BPX","UBE2V1P9","RNU6-555P","AL121823.1","PABPC5-AS1","AL662874.1","PABPC5","SERBP1P4","PCDH11X","RNU2-26P","VDAC1P3","EIF4A1P10","KRT18P11","SNX3P1X","AL121871.1","AL121871.2","AL158053.1","AL359263.1","ST13P18","AL023280.1","RPL7P55","NAP1L3","FAM133A","Z94722.1","RNU6-332P","RF00019","AL390840.1","PAICSP7","CCNB1IP1P3","MIR548M","AL022161.1","CALM1P1","RNA5SP510","AL365400.1","HNRNPDLP3","HNRNPDLP1","RPS7P13","AL365400.2","AL137845.2","RN7SL379P","AL137845.1","RPS29P28","BRDTP1","RN7SKP194","AL606530.1","DIAPH2","RF00019","RPA4","NDUFB5P2","RF00017","RN7SL74P","DIAPH2-AS1","AL354685.1","AL354685.2","AL391666.1","RPL6P29","AL357312.1","EEF1A1P15","HMGB1P32","AL157778.1","AL137843.1","XRCC6P5","B3GNT2P1","RF00402","AL359641.1","RPSAP8","PCDH19","TNMD","TSPAN6","SRPX2","SYTL4","PPIAP89","Z95327.1","Z95327.2","CSTF2","RF00411","NOX1","HNRNPA1P26","HNRNPA1P27","Z73417.1","XKRX","Z97985.1","ARL13A","TRMT2B","TRMT2B-AS1","TMEM35A","CENPI","Z70280.1","DRP2","TAF7L","RNU6-934P","NANOGNBP3","RPL21P132","TIMM8A","BTK","RPL36A","RPL36A-HNRNPH2","GLA","HNRNPH2","ARMCX4","PPIAP90","AC234775.2","ARMCX1","ARMCX7P","ARMCX6","ARMCX3","ARMCX3-AS1","AC234775.3","RNU6-30P","ARMCX2","AC234775.1","RNU6-587P","FO082842.1","AL672207.1","NXF5","ZMAT1","Z68868.1","RNU6-345P","Z80107.2","Z80107.1","MTND6P13","TCEAL2","TCEAL6","BEX5","TCP11X3P","TCP11X1","NXF2","AC234791.1","AC235565.2","NXF2B","AC235565.1","TCP11X2","TMSB15A","FOXN3P1","NXF4","ARMCX5","ARMCX5-GPRASP2","AL035427.1","AL035551.1","GPRASP1","RNU6-589P","BEND7P1","GPRASP2","BHLHB9","LINC00630","MTND1P32","MTND2P2","MTCO1P19","MTCO2P19","MTATP6P19","MTCO3P19","MTND4P32","MTND5P26","MTND6P32","MTCYBP32","Z68871.1","RAB40AL","Z95624.1","Z73361.1","BEX1","NXF3","Z75746.1","RPSAP59","BEX4","TCEAL8","Z68694.1","TCEAL5","BEX2","TCEAL7","Z92846.1","TCEAL9","BEX3","AL606763.1","Z69733.1","RAB40A","TCEAL4","Z73965.1","TCEAL3","TCEAL3-AS1","TCEAL1","AL049610.1","MORF4L2","MORF4L2-AS1","GLRA4","TMEM31","PLP1","RAB9B","RNA5SP511","AC234782.2","AC234782.4","AC234782.3","TMSB15B-AS1","TMSB15B","AC234782.1","DPPA3P1","H2BFWT","H2BFM","AC234783.1","TMSB15B","SLC25A53","ZCCHC18","FAM199X","ESX1","IL1RAPL2","PHBP10","RPL18AP14","TEX13A","KCTD9P2","RNU6-207P","NRK","SERPINA7","AL512661.1","MUM1L1","AL133271.1","RF00019","NAP1L4P2","SERPINA7P1","AL590808.1","CXorf57","MIR548AN","RNF128","TBC1D8B","MORC4","RIPPLY1","CLDN2","EEF1A1P40","RBM41","NUP62CL","AL390039.1","RF00019","PIH1D3","MYCLP1","DNAJA1P3","KRT18P49","FRMPD3-AS1","FRMPD3","PRPS1","TSC22D3","NCBP2L","MID2","AL034399.2","RF00019","AL034399.1","NLRP3P1","TEX13B","VSIG1","PSMD10","ATG4A","COL4A6","AL034369.1","COL4A5","RF00019","AL035425.3","AL035425.2","AL035425.4","IRS4","AL035425.1","RNU6-309P","MIR6087","AL034403.1","GUCY2F","NXT2","AL118496.1","KCNE5","ACSL4","AL118496.2","RF00019","RPS5P7","TMEM164","MIR652","MIR3978","AMMECR1","SNORD96B","AMMECR1-IT1","GNG5P2","RTL9","TDGF1P3","AL512882.1","CHRDL1","PAK3","FCF1P4","GLUD1P9","CAPN6","DCX","RNU6-496P","HMGB1P12","SERTM2","AL589880.1","EIF4BP7","RPL18AP15","ALG13","RNA5SP512","ALG13-AS1","TRPC5","TRPC5OS","AC005191.1","DPRXP7","AL392112.1","RTL4","LHFPL1","RF00019","HMGB3P30","AMOT","MIR4329","RN7SL266P","RNU6-1015P","AL031183.1","AC233289.1","XACT","QTRT1P1","RF00012","RNU1-57P","RN7SL93P","RF00088","AL953862.1","AL953862.2","SSU72P1","HTR2C","RPL36AP53","SNORA35","MIR764","MIR1912","MIR1264","MIR1298","MIR1911","HSPA8P7","MIR448","AL355812.1","IL13RA2","RNU6-648P","AL121878.1","YAP1P2","LRCH2","SNORA35B","RF00019","RBMXL3","RPL36P18","LUZP4","AC239600.2","AC239600.1","PLS3-AS1","RF00264","PLS3","AC005000.2","ASS1P5","EEF1GP5","AC005000.1","DANT1","DANT2","RN7SL712P","AKR1B1P8","API5P1","AGTR2","RNU6-154P","SLC6A14","CT83","BX119904.3","BX119904.4","BX119904.2","BX119904.1","RNU6-1323P","SETP8","AC005002.2","AC005002.1","AC006963.1","KLHL13","RF00019","TUBB4BP3","RPL12P43","AL391358.1","WDR44","MIR1277","DOCK11","RF00019","RBBP8P1","IL13RA1","RF00566","AL391280.1","ZCCHC12","LINC01285","AC006965.1","AL772284.1","LONRF3","AL772284.2","KIAA1210","ARL5AP1","HNRNPA1P28","AC004835.2","PGRMC1","AKAP17BP","AC004835.1","AC004973.1","MRPS17P9","SLC25A43","AC004000.1","RNU1-67P","RN7SL118P","RNY3P16","SLC25A5-AS1","SLC25A5","CXorf56","UBE2A","NKRF","SEPT6","MIR766","AC005052.1","SOWAHD","RPL39","SNORA69","UPF3B","RNF113A","NDUFA1","AKAP14","NKAP","RHOXF1P3","RHOXF1P2","RHOXF1P1","RHOXF1-AS1","RHOXF2B","RHOXF1","LINC01402","NKAPP1","RHOXF2","SFR1P1","EEF1A1P30","ZBTB33","TMEM255A","AL512286.1","ATP1B4","LAMP2","RNU7-37P","CUL4B","MCTS1","C1GALT1C1","AC011890.2","AC011890.1","PA2G4P1","CT47B1","AC008162.1","AC008162.2","CT47A12","AL670379.6","CT47A11","AL670379.4","CT47A10","AL670379.10","CT47A9","AL670379.9","CT47A8","AL670379.2","CT47A7","AL670379.12","CT47A6","AL670379.11","CT47A5","AL670379.7","CT47A4","AL670379.8","CT47A3","AL670379.5","CT47A2","AL670379.3","CT47A1","AL670379.1","AC006144.1","GLUD2","HSPA8P1","MIR3672","TPT1P13","AL359851.1","AL441985.1","AL357562.1","RPL3P12","RF00012","MRRFP1","GRIA3","AL590139.1","AL030996.1","TUBB4AP1","THOC2","FERP1","MEMO1P4","RNU7-69P","CHCHD2P1","RN7SL190P","RF00019","XIAP","XIAP-AS1","RNU6-122P","AL121601.2","AL121601.1","STAG2","ZIK1P1","RF00561","HSPA8P20","SH2D1A","TEX13D","NPM1P34","AL022718.1","TENM1","Z85995.1","AL008707.1","TEX13C","AL627231.1","AL645820.1","AL445072.1","DCAF12L2","MTCO1P53","MTND4LP1","MTND4P24","Z69908.1","DCAF12L1","MTCYBP38","PRR32","Z82209.1","Z82209.2","AL662814.1","AL591643.1","Z75741.2","Z75741.1","ACTRT1","Z74696.2","BTG3P1","Z74696.1","RPL7AP72","AL442647.1","AL442647.2","KRT18P44","RPL32P35","AL359845.1","RPS26P56","RNA5SP513","SMARCA1","RF01169","OCRL","APLN","XPNPEP2","SASH3","AL023653.1","RF00017","ZDHHC9","AL034405.1","SALL4P2","UTP14A","BCORL1","ELF4","AIFM1","RAB33A","ZNF280C","RNU6-1130P","AL035423.1","SLC25A14","GPR119","RBMX2","Z82195.2","FAM45BP","Z82195.1","ENOX2","AL049733.1","LINC01201","ARHGAP36","RN7SL191P","OR11Q1P","AL603758.1","IGSF1","OR11N1P","OR5AW1P","OR5BH1P","OR1AA1P","AL049734.2","AL049734.1","OR13H1","OR13K1P","OR7L1P","OR2AF1P","HDGFP1","FIRRE","MCRIP2P1","PNKDP1","AL008629.1","RNA5SP514","STK26","FRMD7","AL049792.1","RAP2C","RAP2C-AS1","MBNL3","RNU6-98P","HS6ST2","HS6ST2-AS1","Z82205.1","USP26","Z77249.1","RF00393","TFDP3","RNU1-115P","GPC4","RNU6-203P","GPC3","AL009174.1","RPSAP63","AF003529.1","RF00019","TIMM8BP2","AC002407.1","MIR363","MIR92A2","MIR19B2","MIR20B","MIR18B","MIR106A","LARP1BP3","CCDC160","FO393409.1","PHF6","HPRT1","AC004383.1","MIR450B","MIR450A1","MIR450A2","MIR542","MIR503HG","MIR503","MIR424","LINC00629","PLAC1","AL672032.1","RPL21P133","RPS7P12","RNU4-44P","FAM122B","FAM122C","AL691477.1","MOSPD1","RNU6-616P","LINC02243","HMGB3P31","SMIM10","RTL8B","RTL8C","RTL8A","SMIM10L2B-AS1","NCLP2","SMIM10L2B","ETDB","AC234771.1","AC234771.3","CT55","AC234771.4","AC234771.2","AC234771.5","ZNF75D","ETDA","AL590282.1","ETDC","AL590282.2","ZNF449","AL450472.1","SMIM10L2A","RNA5SP515","CROCCP1","AL450472.3","AL450472.2","INTS6L-AS1","INTS6L","AL391380.1","SAGE4P","SAGE3P","SAGE2P","AC240442.1","CT45A1","MGAT2P1","MGAT2P2","CT45A3","CT45A5","CT45A6","CT45A2","CT45A7","CT45A8","CT45A9","CT45A10","SAGE1","CT45A11P","MMGT1","SLC9A6","GAPDHP67","E2F6P4","RF01210","FHL1","MAP7D3","STK24P1","ADGRG4","BRS3","HTATSF1","VGLL1","MIR934","RF00019","RNU6-320P","LINC00892","CD40LG","ARHGEF6","RNU6-972P","AL683813.2","RPL7P56","RANP4","RF00019","AL683813.1","RAB28P5","RBMX","SNORD61","AL390879.1","RPL22P23","SRRM1P3","GPR101","AL355309.1","RAC1P4","AL035443.1","ZIC3","Z96074.1","RN7SL325P","ZFYVE9P1","RNU6-985P","RN7SKP31","MAGEA13P","KRT8P6","FGF13","AL031386.1","MIR504","FGF13-AS1","Z83313.1","SNURFL","SRD5A1P1","F9","MCF2","RF01210","ATP11C","RNU6ATAC23P","RF00425","MIR505","CXorf66","AL589987.2","HNRNPA3P3","RN7SL727P","AL589987.1","FO393408.1","AL137014.1","RF00066","RPS17P17","SOX3","AL844175.1","LINC00632","CDR1","AL078639.1","MIR320D2","AL451048.1","SPANXB1","RNU6-3P","AC234778.1","AC234778.2","LDOC1","SPANXC","RBMX2P2","AC234779.1","SPANXA2-OT1","SPANXA1","SPANXA2","AC235097.1","SPANXD","MAGEC3","MAGEC1","AL023773.2","AL023773.1","AL031073.1","MAGEC2","AL109620.1","RNA5SP516","SPANXN4","RN7SKP81","RN7SKP149","AC239727.1","PGBD4P6","MTND1P33","MTND2P39","SPANXN3","SLITRK4","HNRNPH1P2","SPANXN2","AL500522.1","AL500522.2","UBE2NL","AC234064.1","RRM2P4","HNRNPCP10","RN7SKP189","CYCSP44","AL713923.1","SPANXN1","AL391256.1","AL109653.1","AL109653.2","SLITRK2","MIR892C","MIR890","MIR888","MIR892A","MIR892B","MIR891B","MIR891A","RNA5SP517","AL109913.1","ELL2P4","Z97180.1","CXorf51B","CXorf51A","Z99497.1","Z99497.2","AL589669.1","MIR513C","MIR513B","MIR513A1","MIR513A2","MIR506","MIR507","MIR508","MIR514B","MIR509-2","MIR509-3","MIR509-1","MIR510","MIR514A1","MIR514A2","MIR514A3","AL096861.1","AL009048.1","AC016925.1","AC016925.2","RNU6-382P","L29074.1","FMR1-AS1","RF02118","FMR1","FMR1-IT1","FMR1NB","RNA5SP524","FTH1P8","U40455.1","RPL7L1P11","AC002368.1","AFF2","AFF2-IT1","RN7SKP267","AC231760.1","IDS","AC244197.3","AC244197.2","IDSP1","LINC00893","CXorf40A","HSFX3","MAGEA9B","HSFX2","TMEM185A","AC244197.1","MAGEA11","AC244098.2","AC244098.1","AC244098.3","TMEM185AP1","HSFX1","MAGEA9","MAGEA7P","DUTP4","LINC00850","MAGEA8-AS1","MAGEA8","CXorf40B","HSFX4","LINC00894","BX322650.1","MIR2114","XRCC6P2","MAMLD1","MTM1","MTMR1","CD99L2","PPIAP91","AF274573.1","RNU6-383P","HMGB3","RPL19P21","RPL12P50","RNA5SP525","MIR4330","GPR50-AS1","GPR50","KC877982.1","AF013593.1","RF00017","VMA21","BX546450.2","BX546450.1","PASD1","AF274854.1","PRRG3","FATE1","CNGA2","MAGEA4-AS1","MAGEA4","GABRE","MIR224","MIR452","RPSAP60","MAGEA5","MAGEA10-MAGEA5","MAGEA10","AC116666.1","GABRA3","RNU6-764P","MIR105-1","MIR767","MIR105-2","KRT8P8","GABRQ","AC244102.2","MAGEA3","CSAG2","MAGEA2B","CSAG1","MAGEA12","CSAG4","AC244102.1","MAGEA2","CSAG3","MAGEA6","CETN2","NSDHL","ZNF185","PNMA5","AC243591.1","AC243428.1","PNMA3","PNMA6A","PNMA6B","AC152010.1","MAGEA1","AC236972.2","AC236972.3","AC236972.1","AC236972.4","PNMA6F","ZNF275","AC152007.1","PNMA6E","RN7SL667P","ZFP92","TREX2","HAUS7","U82695.1","BGN","ATP2B3","CCNQ","AF274858.1","KRT18P48","DUSP9","RPL18AP16","RN7SL687P","PNCK","SLC6A8","BCAP31","ABCD1","U52111.1","PLXNB3","SRPK3","IDH3G","SSR4","PDZD4","CYCSP45","L1CAM","U52112.2","U52112.1","AVPR2","ARHGAP4","NAA10","RENBP","HCFC1","HCFC1-AS1","TMEM187","MIR3202-1","MIR3202-2","IRAK1","MIR718","MECP2","OPN1LW","TEX28P2","OPN1MW","TEX28P1","OPN1MW2","AC244097.1","OPN1MW3","TEX28","TKTL1","AC245140.1","FLNA","AC245140.3","EMD","RPL10","AC245140.2","SNORA70","DNASE1L1","TAZ","AC244090.1","ATP6AP1","GDI1","FAM50A","MIR6858","PLXNA3","LAGE3","UBL4A","SLC10A3","RN7SL697P","FAM3A","AC244090.3","G6PD","IKBKG","FAM223A","ATF4P2","CTAG1A","AC244090.2","CTAG1B","AC244107.2","ATF4P1","FAM223B","IKBKGP1","CTAG2","AC244107.1","OR3B1P","GAB3","DKC1","SNORA36A","MIR664B","SNORA56","MPP1","HMGN1P37","SMIM9","F8","H2AFB1","F8A1","MIR1184-1","BX842559.1","EEF1A1P31","BX842559.2","FUNDC2","CMC4","MTCP1","BRCC3","BX293995.1","VBP1","BX682237.1","RAB39B","CLIC2","AC234781.2","AC234781.3","AC234781.4","AC234781.1","AC234781.5","H2AFB2","F8A2","MIR1184-2","F8A3","MIR1184-3","H2AFB3","TMLHE-AS1","BX571846.1","TMLHE","SPRY3","AMD1P2","DPH3P2","VAMP7","ELOCP24","TRPC6P","IL9R","AJ271736.1","WASIR1","WASH6P","DDX11L16","RNU6-1334P","SRY","RNASEH2CP1","TOMM22P2","RPS4Y1","HSFY3P","NAP1L1P2","AC006157.1","ZFY","ZFY-AS1","EEF1A1P41","LINC00278","AGPAT5P1","PRRC2CP1","TGIF2LY","USP12PY","RNF19BPY","AC012078.1","UBE2V1P3","AC010737.1","RNU6-303P","SERBP1P2","AC010722.1","PCDH11Y","RNU2-57P","VDAC1P6","EIF4A1P2","KRT18P10","SNX3P1Y","RPL26P37","AC010977.1","DLGAP5P1","TTTY23B","TSPY2","FAM197Y9","TSPY11P","AC006335.3","TSPY19P","AC006335.1","AC006335.2","RBMY2GP","LINC00280","TTTY1B","TTTY2B","TTTY21B","TTTY7","TTTY8B","AC010154.1","TSPY17P","SRIP3","AC013412.1","GOT2P5","AMELY","ATP5PFP1","TBL1Y","AC011297.1","GPR143P","PRKY","RN7SKP282","RF00019","RNU6-941P","RNU6-521P","AC007274.3","RBMY2HP","AC007274.1","TSPY12P","AC007274.2","TTTY16","RFTN1P1","TTTY12","AC007275.1","ZNF92P1Y","AC010678.1","ZNF736P8Y","BPY2DP","ZNF736P7Y","ZNF736P9Y","RBMY2JP","RBMY2KP","TSPY24P","ZNF736P6Y","MTND6P1","MTCYBP1","MTND1P1","MTND2P3","TRIM60P3Y","ZNF736P10Y","AC016991.1","LINC00279","TTTY18","TTTY19","TTTY11","AC007967.2","AC007967.1","AC007967.4","AC007967.3","OFD1P3Y","CDY3P","USP9YP22","USP9YP4","ELOCP4","RBMY1A3P","AC006158.1","TTTY20","TSPY4","FAM197Y8","TSPY8","FAM197Y7","TSPY7P","FAM197Y6","TSPY3","FAM197Y5","TSPY1","FAM197Y4","TSPY9P","FAM197Y3","TSPY6P","FAM197Y2","TSPY10","FAM197Y1","TSPY15P","RBMY3AP","TSPY25P","TSPY16P","AC017019.1","TTTY8","TTTY7B","TTTY21","TTTY2","TTTY1","TTTY22","AC010891.1","RBMY2NP","AC006986.1","TSPY18P","TSPY13P","TTTY23","RBMY2OP","RBMY2QP","TSPY20P","TSPY5P","AC006987.4","AC006987.2","RNA5SP518","AC006987.3","RNA5SP519","AC006987.1","DUX4L31","PCMTD1P1","CDC27P2","AC010970.1","RNA5-8SP6","AC140113.4","C2orf27AP1","AC140113.3","AC140113.2","AC140113.1","AC134878.1","AC134878.2","ANKRD20A6P","SNX18P1Y","DUX4L16","DUX4L17","DUX4L18","DUX4L19","PABPC1P5","SLC9B1P1","ACTR3BP1","AC134879.3","MTND1P12","AC134879.1","AC134879.2","RCC2P1","ASS1P6","MXRA5Y","RPS24P1","ARSFP1","RN7SL702P","FAM8A4P","ARSEP1","ARSDP1","GYG2P1","XGY1","SHROOM2P1","MED14P1","TTTY15","USP9Y","CDY4P","DDX3Y","CASKP1","SFPQP1","TAB3P1","DPPA2P1","UTY","PSMA6P1","TMSB4Y","ANOS2P","VCY","VCY1B","PNPLA4P1","AC010723.1","NLGN4Y","AGKP1","NLGN4Y-AS1","MED13P1","CYCSP46","AC006989.1","PUDPP1","STSP1","RF00401","RNU6-109P","RNU6-184P","SURF6P1","ELOCP35","FAM41AY1","AC015978.1","TUBB1P2","FAM224B","RNA5SP520","RNA5SP521","RF01518","CLUHP1","TAF9P1","AC007742.2","CDY5P","AC007742.1","PRYP1","ACTG1P2","XKRY","USP9YP23","USP9YP27","RNU1-128P","TRAPPC2P3","OFD1P1Y","ELOCP6","CDY2B","CDY6P","USP9YP7","USP9YP6","CDY7P","USP9YP34","USP9YP32","CDY8P","CDY2A","ELOCP12","OFD1P2Y","TRAPPC2P8","USP9YP15","RNU1-95P","USP9YP16","XKRY2","ACTG1P11","PRYP2","ELOCP26","CDY9P","TAF9P2","CLUHP2","FAM224A","RF01518","RNA5SP522","RNA5SP523","TUBB1P1","AC007241.1","FAM41AY2","ELOCP13","OFD1P4Y","USP9YP14","RNU1-48P","USP9YP5","AC022486.1","XKRYP1","PRYP5","ELOCP7","USP9YP1","HSFY1","GPM6BP1","TTTY9B","OFD1P5Y","RAB9AP4","TRAPPC2P7","OFD1P6Y","HSFY2","GPM6BP2","USP9YP2","ELOCP14","PRYP6","XKRYP2","USP9YP10","USP9YP28","RNU1-41P","OFD1P7Y","MTCYBP2","TTTY14","ZNF839P1","CD24P4","RNU6-255P","AC010133.1","GAPDHP19","BCORP1","TXLNGY","AC009977.1","AC010889.1","KDM5D","AC009233.1","RCC2P2","ZNF886P","ZNF885P","TTTY10","KDM5DP1","EIF1AY","TBL1YP1","RPS4Y2","HSFY4P","AC009494.1","GAPDHP17","TMEM167AP1","AC007876.1","TOMM22P1","NEFLP1","AC010086.1","PRORY","RBMY2EP","AC010086.2","RBMY2TP","FAM197Y10","TSPY14P","RBMY1HP","AC010141.3","RBMY1B","RBMY1A1","AC010141.2","AC010141.1","TTTY13","ELOCP5","CDY10P","USP9YP3","USP9YP8","CDY11P","OFD1P16Y","AC007322.2","RBMY1D","AC007322.4","RBMY1E","AC007322.1","RBMY2AP","AC007322.3","OFD1P8Y","HSFY5P","USP9YP17","CDY12P","ELOCP15","PRY2","AC007359.1","TTTY6B","RBMY1F","TSPY23P","RBMY2UP","RBMY1KP","TTTY5","TSPY22P","RBMY2FP","TTTY25P","TSPY21P","RBMY1J","AC008175.1","TTTY6","PRY","ELOCP8","CDY13P","USP9YP24","HSFY7P","OFD1P9Y","AC008175.2","RBMY2BP","AC016694.1","RBMY2WP","TTTY17A","AC016911.1","ZNF736P11Y","TTTY4","BPY2","AC006366.1","TRIM60P8Y","ZNF736P3Y","TRIM60P9Y","DAZ1","DAZ2","PPP1R12BP2","RF00156","REREP1Y","AC009947.1","RBMY2CP","AC009947.2","OFD1P10Y","HSFY6P","USP9YP18","CDY14P","ELOCP16","PRYP3","XKRYP3","USP9YP25","USP9YP29","RNU1-97P","RAB9AP1","TRAPPC2P9","OFD1P11Y","ELOCP9","CDY15P","XKRYP4","USP9YP13","USP9YP11","TTTY3B","USP9YP12","RNU1-86P","RAB9AP5","TRAPPC2P10","OFD1P12Y","ELOCP10","CDY1B","CDY17P","USP9YP35","USP9YP31","CDY18P","AC023274.2","GOLGA6L11P","DNM1P24","AC023274.1","CSPG4P2Y","CSPG4P3Y","AC012005.2","GOLGA2P2Y","RN7SL818P","UBE2Q2P4Y","LINC00265-2P","CICP2","LINC00266-2P","AC012005.1","RBMY2XP","TTTY17B","TRIM60P5Y","ZNF736P12Y","TTTY4B","BPY2B","AC010153.1","TRIM60P10Y","ZNF736P2Y","TRIM60P11Y","DAZ3","DAZ4","AC006338.2","ZNF736P1Y","AC006338.1","ZNF736P5Y","BPY2C","TTTY4C","ZNF736P4Y","AC006386.1","TTTY17C","RBMY2YP","AC006386.2","LINC00266-4P","CICP1","LINC00265-3P","UBE2Q2P5Y","GOLGA2P3Y","RN7SL725P","AC006328.2","CSPG4P4Y","CSPG4P1Y","DNM1P48","AC006328.1","GOLGA6L16P","AC007562.1","CDY19P","USP9YP36","USP9YP33","CDY20P","CDY1","ELOCP34","OFD1P13Y","TRAPPC2P5","RAB9AP2","USP9YP30","RNU1-107P","TTTY3","USP9YP9","USP9YP19","XKRYP5","CDY22P","ELOCP17","OFD1P18Y","TRAPPC2P4","RAB9AP3","USP9YP20","RNU1-40P","USP9YP21","XKRYP6","PRYP4","ELOCP11","CDY23P","USP9YP26","HSFY8P","OFD1P15Y","RBMY2DP","REREP2Y","AC024067.1","RF00156","PPP1R12BP1","RNU6-1314P","CYCSP48","ANKRD36P1","AC013734.1","TPTE2P4","CYCSP49","SLC25A15P1","PARP4P1","CCNQP2","CTBP2P1"]
        
        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a;
        }

        function getCNVColor(cnv){
            if(cnv.CNV_Class != ''){
                if(isFocal && cnv.CNV_Scale =='largescale'){
                    return 'rgb(0,0,0,0)'
                }
                else{
                    return colorScale(cnv.CNV_Class)
                }
            }
            else{
                return 'rgb(0,0,0,0)'
            }
            
        }
        
        function getVARColor(impact){
            if (impact == "HIGH"){
                return colorScale('HIGH')
            } else if (impact == "MODERATE"){
                return colorScale('MODERATE')
            } else {
                return 'rgb(0,0,0,0)'
            }
        }
        
        function rankSampleSubset(subset, metadata, genes){
            score = BigInt(0)
            multiplier = BigInt(Math.pow(10,genes.length))
            for(i in subset){
                geneRankPos = genes.indexOf(subset[i].Gene)
                
                if(metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Gender == 'male' && chrXY_geneList.includes(subset[i].Gene) ){
                    subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy /2
                }
                else{
                    subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy
                }
                
                //subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy
                
                if (subset[i].Impact == "MODERATE"){
                    score = score + BigInt(3)*multiplier/BigInt(Math.pow(10,geneRankPos))
                }
                else if (subset[i].Impact == "HIGH"){
                    score = score + BigInt(6)*multiplier/BigInt(Math.pow(10,geneRankPos))
                }
                if(isFocal){
                    if (subset[i].CNV_Class != "" && subset[i].CNV_Scale == 'focal'){
                        if(subset[i].CNV_Class == "amplification"){
                            score = score + BigInt(2)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "gain"){
                            score = score + BigInt(1)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "loss"){
                            score = score + BigInt(2)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "deletion"){
                            score = score + BigInt(1)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                    }
                }
                else{
                    if (subset[i].CNV_Class != ""){
                        if(subset[i].CNV_Class == "amplification"){
                            score = score + BigInt(2)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "gain"){
                            score = score + BigInt(1)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "loss"){
                            score = score + BigInt(2)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                        else if(subset[i].CNV_Class == "deletion"){
                            score = score + BigInt(1)*multiplier/BigInt(Math.pow(10,geneRankPos))
                        }
                    }
                }
                
            }
            return score
        }
        
        function rankGeneSubset(subset, metadata){
            for(i in subset){
                //subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy
                
                if(metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Gender == 'male' && chrXY_geneList.includes(subset[i].Gene) ){
                    //console.log('MALE! ' + d.Gene + " " + d.CNV + " " + ploidy)
                    subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy /2
                }
                else{
                    subset[i].Ploidy = metadata.filter(function(f){return f.Sample == subset[i].Sample})[0].Ploidy
                }
                
            }
            if(isFocal){
                high_amp_num = subset.filter(function(f){return f.CNV_Class == "amplification" && f.CNV_Scale == "focal"}).length
                amp_num = subset.filter(function(f){return f.CNV_Class == "gain" && f.CNV_Scale == "focal"}).length
                deep_del_num = subset.filter(function(f){return f.CNV_Class == "loss" && f.CNV_Scale == "focal"}).length
                del_num = subset.filter(function(f){return f.CNV_Class == "deletion" && f.CNV_Scale == "focal"}).length
            }
            else{
                high_amp_num = subset.filter(function(f){return f.CNV_Class == "amplification"}).length
                amp_num = subset.filter(function(f){return f.CNV_Class == "gain"}).length
                deep_del_num = subset.filter(function(f){return f.CNV_Class == "loss"}).length
                del_num = subset.filter(function(f){return f.CNV_Class == "deletion"}).length
            }
            mod_num = subset.filter(function(f){return f.Impact == "MODERATE"}).length
            high_num = subset.filter(function(f){return f.Impact == "HIGH"}).length
            

            score = high_num * 30
                + mod_num * 20
                + deep_del_num * 20
                + high_amp_num * 20
                + del_num * 4
                + amp_num * 4
            
            return score
        }
        
        function rankSamples(samples, data, metadata, genes){
            //console.log(metadata)
            sampleRankList = []
            for (i in samples){
                sampleData = data.filter(function(f){
                    return f.Sample == samples[i]
                })
                sampleRankList.push({Sample: samples[i], score: rankSampleSubset(sampleData,metadata,genes)})
            }
            sampleRankList.sort(function(a,b){
		if(b.score < a.score){
			return -1
		}
		else{
			return 1
		}
	    })
            console.log(sampleRankList)
            return [...new Set(sampleRankList.map(a => a.Sample))]
        }
        
        function rankGenes(data, geneList, metadata){
            rankList = []
            for (i in geneList){
                
                geneData = data.filter(function(f){
                    return f.Gene == geneList[i]
                })
                rankList.push({gene: geneList[i], score: rankGeneSubset(geneData,metadata)})
            }
            rankList = rankList.filter(function(f){return f.gene != 'Unknown'})
            
            return rankList.sort(function(a,b){return b.score - a.score})
        }
        
        function readjustPos(genes, samples, metaList){
            for(var i in samples){
                //redraw sample label
                d3.selectAll('#' + samples[i] + "_label")
                    //.attr('x', (y(cellWidth) + cellPadding) * i)
                    .attr('transform','rotate(45,' + ((y(cellWidth) + cellPadding) * i + y(yAxisWidth) )+ ',' + y(10)+ ')')
                //redraw sample variants
                d3.selectAll('.' + samples[i])
                    .attr('x', (y(cellWidth) + cellPadding) * i)
            }
            for(var i in genes){
                d3.selectAll('.' + genes[i])
                    .attr('transform', function(d){
                        return 'translate(' + y(yAxisWidth) + ',' + (y(cellHeight) + cellPadding) * i + ')'
                    })
            }
            d3.selectAll('.xaxis')
                .attr('transform', 'translate(0,'+(((y(cellHeight) + cellPadding) * genes.length) + ((y(metadataHeight) + cellPadding) * metaList.length))+")")
            d3.selectAll('.metadata')
                .attr('transform', function(d){
                    return 'translate(' + y(yAxisWidth) + ',' + ((y(cellHeight) + cellPadding) * genes.length) + ')'
                })
        }
        
        function addVariants(data, genes, samples, metadata){
            var variants = svg.append('g').attr('class','variants')
            
            variant = variants.selectAll('.variant')
                .data(data).enter()
                .append('g')
                .attr('transform', function(d){
                    return 'translate(' + y(yAxisWidth) + ',' + (y(cellHeight) + cellPadding) * genes.indexOf(d.Gene) + ')'
                })
                .attr('class', function(d){return d.Gene})

            //draw cnv square
            variant.append('rect')
                .attr('class', function(d){return d.Sample + " CNV COL"})
                .attr('width',y(cellWidth))
                .attr('height',y(cellHeight))
                .attr('fill',function(d){
                    /*
                    if(metadata.filter(function(f){return f.Sample == d.Sample})[0].Gender == 'male' && chrXY_geneList.includes(d.Gene) ){
                        console.log('MALE! ' + d.Gene + " " + d.CNV + " " + ploidy)
                        var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy) /2
                    }
                    else{
                        var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy * 2) /2
                    }
                    */
                    return getCNVColor(d)
                })
                .attr('x', function(d){return (y(cellWidth) + cellPadding) * samples.indexOf(d.Sample)})
                .attr('pointer-events', function(d){
                    if (d.CNV_Class != ''){
                        return 'all'
                    }
                    else {
                        return 'none'
                    }
                })
                .on('mouseover', function(d){
                    //console.log(d)
                    div.html(
                        '<b>' + d.Sample + '</b><br>' +
                        'Gene: ' + d.Gene + '<br>' +
                        'CNV: ' + d.CNV + '<br>' + 
                        'CNV_Class: ' + d.CNV_Class + '<br>' + 
                        'CNV_Scale: ' + d.CNV_Scale + '<br>' + 
                        'Ploidy: ' + d.Ploidy
                    )
                    div.style("left", (d3.event.pageX + 10) + "px")
                    div.style("top", (d3.event.pageY + 15) + "px")
                    div.style('opacity','0.9')
                    div.style('background', 'gray')
                    d3.select(this)
                        .attr('stroke','black')
                        .attr('stroke-width', '2px')
                })
                .on('mouseout', function(){
                    d3.select(this)
                        .attr('stroke','none')
                    div.style('opacity','0')
                })

            //draw var square
            variant.append('rect')
                .attr('class', function(d){return d.Sample + " VAR COL"})
                .attr('width',y(cellWidth))
                .attr('height',y(cellHeight/2))
                .attr('fill',function(d){return getVARColor(d.Impact)})
                .attr('x', function(d){return (y(cellWidth) + cellPadding) * samples.indexOf(d.Sample)})
                .attr('y', y(cellHeight/4))
                .attr('pointer-events', function(d){
                    if (d.Impact == 'MODERATE' || d.Impact == 'HIGH'){
                        return 'all'
                    }
                    else {
                        return 'none'
                    }
                })
                .on('mouseover', function(d){
                    if (d.Impact == 'MODERATE' || d.Impact == 'HIGH'){
                        div.html(
                            '<b>' + d.Sample + '</b><br>' +
                            'Gene: ' + d.Gene + '<br>' +
                            'Impact: ' + d.Impact
                        )
                        div.style("left", (d3.event.pageX + 10) + "px")
                        div.style("top", (d3.event.pageY + 15) + "px")
                        div.style('opacity','0.9')
                        div.style('background', 'gray')
                    }
                    d3.select(this)
                        .attr('stroke','black')
                        .attr('stroke-width', '2px')
                })
                .on('mouseout', function(){
                    d3.select(this)
                        .attr('stroke','none')
                    div.style('opacity','0')
                })
        }
        
        function colorMetadata(key,metadata){
            var metaValues = []
            metadata.forEach(function(d){metaValues.push(d[key])})
            //console.log(metaValues)
            //check if metadata is numerical
            if(!metaValues.some(isNaN)){
                //if numerical, get range
                metaValues = metaValues.map(Number);        
                var hue = Math.floor(Math.random()*360)
                var hsl_high = d3.color('hsl('+hue+',90%,15%)')
                var hsl_low = d3.color('hsl('+hue+',90%,80%)')
                var outputScale = d3.scaleLinear().range([hsl_low.toString(),hsl_high.toString()]).domain([Math.min(...metaValues),Math.max(...metaValues)])
                return outputScale
            }
            else {
                if(key == "Site" || key == "Meta_site"){
                    return d3.scaleOrdinal()
                        .range(["#1E90FF","#1C86EE","#E31A1C","#008B00","#6A3D9A","#FF7F00","#000000","#FFD700","#7EC0EE","#FB9A99","#90EE90","#CAB2D6","#FDBF6F","#B3B3B3","#EEE685","#FF83FA","#FF1493","#0000FF","#36648B"])
                        .domain(["Non-brain","Pelvic mass","Lymph node","Liver","Bone","Brain","Right Intercostal Mets","Left Supraclavicular Mets","Right Perihilar LN","Thoracic spine Mets","Prostate","Paratracheal LN","Peripancreatic","Soft tissue-Right pelvic wall","Adrenal gland","Spine","Lung","Other Tissue Type","Peritoneum"])
                }
                //if not numerical, make range with unique list of variables, assign n random colors to?
                uniqValues = [...new Set(metaValues)]
                uniqValues = shuffle(uniqValues)
                colorRange = []
                var saturation = Math.floor(Math.random()*70)
                var lightness = Math.floor(Math.random()*60)
                for(i in uniqValues){
                    //var hue = Math.floor(Math.random()*360)
                    var hue = (360/uniqValues.length) * i
                    colorRange.push('hsl(' + hue + ',' + (30 + saturation) +'%,' + (20 + lightness) + '%)')
                }
                
                if(uniqValues.includes("")){
                    colorRange[uniqValues.indexOf("")] = 'white'
                }
                else{
                    uniqValues.push('')
                    colorRange.push('white')
                }
                //console.log(colorRange)
                return d3.scaleOrdinal().range(colorRange).domain(uniqValues)
                
            }
        }
        
        function arraysEqual(a, b) {
          if (a === b) return true;
          if (a == null || b == null) return false;
          if (a.length !== b.length) return false;

          for (var i = 0; i < a.length; ++i) {
            if (a[i] !== b[i]) return false;
          }
          return true;
        }
        
        //start drawing actual data
        Promise.all([d3.tsv("oncomatrix.wcm.txt"), d3.tsv("metadata.wcm.txt ")]).then(function(d){
            var data = d[0]
            var metadata = d[1]
            
            console.log(data)
            console.log(metadata)
            
            var geneList = [...new Set(data.map(a => a.Gene))]
            var samples = [...new Set(data.map(a => a.Sample))]
            var metaList = Object.keys(metadata[0])
            
            var cgcGeneList = ["A1CF","ABI1","ABL1","ABL2","ACKR3","ACSL3","ACSL6","ACVR1","ACVR2A","AFF1","AFF3","AFF4","AKAP9","AKT1","AKT2","AKT3","ALDH2","ALK","AMER1","ANK1","APC","APOBEC3B","AR","ARAF","ARHGAP26","ARHGAP5","ARHGEF10","ARHGEF10L","ARHGEF12","ARID1A","ARID1B","ARID2","ARNT","ASPSCR1","ASXL1","ASXL2","ATF1","ATIC","ATM","ATP1A1","ATP2B3","ATR","ATRX","AXIN1","AXIN2","B2M","BAP1","BARD1","BAX","BAZ1A","BCL10","BCL11A","BCL11B","BCL2","BCL2L12","BCL3","BCL6","BCL7A","BCL9","BCL9L","BCLAF1","BCOR","BCORL1","BCR","BIRC3","BIRC6","BLM","BMP5","BMPR1A","BRAF","BRCA1","BRCA2","BRD3","BRD4","BRIP1","BTG1","BTK","BUB1B","C15orf65","C2orf44","CACNA1D","CALR","CAMTA1","CANT1","CARD11","CARS","CASC5","CASP3","CASP8","CASP9","CBFA2T3","CBFB","CBL","CBLB","CBLC","CCDC6","CCNB1IP1","CCNC","CCND1","CCND2","CCND3","CCNE1","CCR4","CCR7","CD209","CD274","CD28","CD74","CD79A","CD79B","CDC73","CDH1","CDH10","CDH11","CDH17","CDK12","CDK4","CDK6","CDKN1A","CDKN1B","CDKN2A","CDKN2C","CDX2","CEBPA","CEP89","CHCHD7","CHD2","CHD4","CHEK2","CHIC2","CHST11","CIC","CIITA","CLIP1","CLP1","CLTC","CLTCL1","CNBD1","CNBP","CNOT3","CNTNAP2","CNTRL","COL1A1","COL2A1","COL3A1","COX6C","CPEB3","CREB1","CREB3L1","CREB3L2","CREBBP","CRLF2","CRNKL1","CRTC1","CRTC3","CSF1R","CSF3R","CSMD3","CTCF","CTNNA2","CTNNB1","CTNND1","CTNND2","CUL3","CUX1","CXCR4","CYLD","CYP2C8","CYSLTR2","DAXX","DCAF12L2","DCC","DCTN1","DDB2","DDIT3","DDR2","DDX10","DDX3X","DDX5","DDX6","DEK","DGCR8","DICER1","DNAJB1","DNM2","DNMT3A","DROSHA","DUX4L1","EBF1","ECT2L","EED","EGFR","EIF1AX","EIF3E","EIF4A2","ELF3","ELF4","ELK4","ELL","ELN","EML4","EP300","EPAS1","EPHA3","EPHA7","EPS15","ERBB2","ERBB3","ERBB4","ERC1","ERCC2","ERCC3","ERCC4","ERCC5","ERG","ESR1","ETNK1","ETV1","ETV4","ETV5","ETV6","EWSR1","EXT1","EXT2","EZH2","EZR","FAM131B","FAM135B","FAM46C","FAM47C","FANCA","FANCC","FANCD2","FANCE","FANCF","FANCG","FAS","FAT1","FAT3","FAT4","FBLN2","FBXO11","FBXW7","FCGR2B","FCRL4","FEN1","FES","FEV","FGFR1","FGFR1OP","FGFR2","FGFR3","FGFR4","FH","FHIT","FIP1L1","FKBP9","FLCN","FLI1","FLNA","FLT3","FLT4","FNBP1","FOXA1","FOXL2","FOXO1","FOXO3","FOXO4","FOXP1","FOXR1","FSTL3","FUBP1","FUS","GAS7","GATA1","GATA2","GATA3","GLI1","GMPS","GNA11","GNAQ","GNAS","GOLGA5","GOPC","GPC3","GPC5","GPHN","GRIN2A","GRM3","H3F3A","H3F3B","HERPUD1","HEY1","HIF1A","HIP1","HIST1H3B","HIST1H4I","HLA-A","HLF","HMGA1","HMGA2","HMGN2P46","HNF1A","HNRNPA2B1","HOOK3","HOXA11","HOXA13","HOXA9","HOXC11","HOXC13","HOXD11","HOXD13","HRAS","HSP90AA1","HSP90AB1","ID3","IDH1","IDH2","IGF2BP2","IGH","IGK","IGL","IKBKB","IKZF1","IL2","IL21R","IL6ST","IL7R","IRF4","IRS4","ISX","ITGAV","ITK","JAK1","JAK2","JAK3","JAZF1","JUN","KAT6A","KAT6B","KAT7","KCNJ5","KDM5A","KDM5C","KDM6A","KDR","KDSR","KEAP1","KIAA1549","KIAA1598","KIF5B","KIT","KLF4","KLF6","KLK2","KMT2A","KMT2C","KMT2D","KNSTRN","KRAS","KTN1","LARP4B","LASP1","LCK","LCP1","LEF1","LEPROTL1","LHFP","LIFR","LMNA","LMO1","LMO2","LPP","LRIG3","LRP1B","LSM14A","LYL1","LZTR1","MAF","MAFB","MALAT1","MALT1","MAML2","MAP2K1","MAP2K2","MAP2K4","MAP3K1","MAP3K13","MAPK1","MAX","MB21D2","MDM2","MDM4","MDS2","MECOM","MED12","MEN1","MET","MGMT","MITF","MKL1","MLF1","MLH1","MLLT1","MLLT10","MLLT11","MLLT3","MLLT4","MLLT6","MN1","MNX1","MPL","MSH2","MSH6","MSI2","MSN","MTCP1","MTOR","MUC1","MUC16","MUC4","MUTYH","MYB","MYC","MYCL","MYCN","MYD88","MYH11","MYH9","MYO5A","MYOD1","N4BP2","NAB2","NACA","NBEA","NBN","NCKIPSD","NCOA1","NCOA2","NCOA4","NCOR1","NCOR2","NDRG1","NF1","NF2","NFATC2","NFE2L2","NFIB","NFKB2","NFKBIE","NIN","NKX2-1","NONO","NOTCH1","NOTCH2","NPM1","NR4A3","NRAS","NRG1","NSD1","NT5C2","NTHL1","NTRK1","NTRK3","NUMA1","NUP214","NUP98","NUTM1","NUTM2A","NUTM2B","OLIG2","OMD","P2RY8","PABPC1","PAFAH1B2","PALB2","PAX3","PAX5","PAX7","PAX8","PBRM1","PBX1","PCBP1","PCM1","PDCD1LG2","PDE4DIP","PDGFB","PDGFRA","PDGFRB","PER1","PHF6","PHOX2B","PICALM","PIK3CA","PIK3CB","PIK3R1","PIM1","PLAG1","PLCG1","PML","PMS1","PMS2","POLD1","POLE","POLG","POLQ","POT1","POU2AF1","POU5F1","PPARG","PPFIBP1","PPM1D","PPP2R1A","PPP6C","PRCC","PRDM1","PRDM16","PRDM2","PREX2","PRF1","PRKACA","PRKAR1A","PRKCB","PRPF40B","PRRX1","PSIP1","PTCH1","PTEN","PTK6","PTPN11","PTPN13","PTPN6","PTPRB","PTPRC","PTPRD","PTPRK","PTPRT","PWWP2A","QKI","RABEP1","RAC1","RAD17","RAD21","RAD51B","RAF1","RALGDS","RANBP2","RAP1GDS1","RARA","RB1","RBM10","RBM15","RECQL4","REL","RET","RFWD3","RGPD3","RGS7","RHOA","RHOH","RMI2","RNF213","RNF43","ROBO2","ROS1","RPL10","RPL22","RPL5","RPN1","RSPO2","RSPO3","RUNDC2A","RUNX1","RUNX1T1","S100A7","SALL4","SBDS","SDC4","SDHA","SDHAF2","SDHB","SDHC","SDHD","SEPT5","SEPT6","SEPT9","SET","SETBP1","SETD1B","SETD2","SF3B1","SFPQ","SFRP4","SGK1","SH2B3","SH3GL1","SIRPA","SIX1","SIX2","SKI","SLC34A2","SLC45A3","SMAD2","SMAD3","SMAD4","SMARCA4","SMARCB1","SMARCD1","SMARCE1","SMC1A","SMO","SND1","SOCS1","SOX2","SOX21","SPECC1","SPEN","SPOP","SRC","SRGAP3","SRSF2","SRSF3","SS18","SS18L1","SSX1","SSX2","SSX4","STAG1","STAG2","STAT3","STAT5B","STAT6","STIL","STK11","STRN","SUFU","SUZ12","SYK","TAF15","TAL1","TAL2","TBL1XR1","TBX3","TCEA1","TCF12","TCF3","TCF7L2","TCL1A","TEC","TERT","TET1","TET2","TFE3","TFEB","TFG","TFPT","TFRC","TGFBR2","THRAP3","TLX1","TLX3","TMEM127","TMPRSS2","TNC","TNFAIP3","TNFRSF14","TNFRSF17","TOP1","TP53","TP63","TPM3","TPM4","TPR","TRA","TRAF7","TRB","TRD","TRIM24","TRIM27","TRIM33","TRIP11","TRRAP","TSC1","TSC2","TSHR","U2AF1","UBR5","USP44","USP6","USP8","VAV1","VHL","VTI1A","WAS","WHSC1","WHSC1L1","WIF1","WNK2","WRN","WT1","WWTR1","XPA","XPC","XPO1","YWHAE","ZBTB16","ZCCHC8","ZEB1","ZFHX3","ZMYM3","ZNF198","ZNF278","ZNF331","ZNF384","ZNF429","ZNF479","ZNF521","ZNRF3","ZRSR2"]
            
            if(metaList.includes('Ploidy')){
                console.log("Metadata includes ploidy.")
            } else {
                console.log("ERROR: metadata does not include 'Ploidy' (case sensitive). Setting all ploidy to 2")
                metadata = metadata.map(v =>  ({...v, Ploidy: 2}))
                console.log(metadata)
            }
            if(metaList.includes('Gender')){
                console.log("Metadata includes gender.")
            } else {
                console.log("ERROR: metadata does not include 'Gender' (case sensitive). Setting all to female")
                metadata = metadata.map(v =>  ({...v, Gender: 'female'}))
                console.log(metadata)
            }
            //make metadata array for if metadata.txt is missing
            //cannot asynchronously read two files. an empty metadata.txt file will have to be generated with preprocessing
            /*
            var metadata = []
            for(i in samples){
                metadata.push({'Sample': samples[i], 'Ploidy': 2})
            }*/
            
            
            console.log("Ranking Genes...")
            var rankList = rankGenes(data, cgcGeneList, metadata)

            //filter data to top 30 ranked
            var topList = rankList.slice(0,30)
            var genes = topList.map(a => a.gene)
            var filteredData = []
            for(i in topList){
                filteredData = filteredData.concat(data.filter(function(f){return f.Gene == topList[i].gene}))
            }
            
            //rank and sort samples based on current gene selection
            samples = rankSamples(samples, filteredData, metadata, genes)

            var longestGene = Math.max(...(genes.map(a => a.length)))
            yAxisWidth = yAxistextSize * (longestGene + 5)
            
            xaxis = svg.append('g')
                .attr('class','xaxis')
                .attr('transform', 'translate(0,'+(((y(cellHeight) + cellPadding) * topList.length) + ((y(metadataHeight) + cellPadding) * metaList.length)) +")")
            yaxis = svg.append('g')
                .attr('class','yaxis')
            
            //function to add gene to y axis
            function addGene(geneToAdd, index){
                var gene = yaxis.append('g')
                    .attr('class', geneToAdd)
                    .attr('transform', function(d){
                        return 'translate(' + y(yAxisWidth) + ',' + (y(cellHeight) + cellPadding) * index + ')'
                    })
                
                for (var i in samples){
                    if(samples[i]){
                        gene.append('rect')
                        .attr('class', samples[i] + ' background COL')
                        .attr('width',y(cellWidth))
                        .attr('height',y(cellHeight))
                        .attr('fill', 'lightgray')
                        .attr('x', function(d){return (y(cellWidth) + cellPadding) * i})
                    }
                    
                }
                gene.append('text')
                    .text(geneToAdd)
                    .attr('id',geneToAdd)
                    .attr('dx', x(-20))
                    .attr('dy', y(cellHeight/2 + 5))
                    .attr('text-anchor', 'end')
                    .attr('font-size',scale(yAxistextSize))
                    .on('click', function(d){
                        //show the x 
                        //console.log(this.id)
                        d3.selectAll(".removeGeneButton")
                            .attr('opacity', 0)
                        d3.selectAll("#"+this.id+"_X")
                            .attr('opacity', 1)
                            .attr("pointer-events", "all")
                    })

                //click to remove gene
                gene.append('svg:foreignObject')
                    .attr('height', '30px')
                    .attr('width', '15px')
                    .attr('class','removeGeneButton')
                    .attr('id', geneToAdd + "_X")
                    .html('<i class="fa fa-times"></i>')
                    .attr('x', x(-18))
                    .attr('y', y(-5 ) )
                    .attr('fill','red')
                    .attr('opacity', 0)
                    .attr("pointer-events", "none")
                    .on('click', function(d){
                        //remove the gene
                        geneToRemove = this.id.slice(0,-2)
                        console.log("Removing " + geneToRemove)
                        removeIndex = genes.indexOf(geneToRemove)
                        if (removeIndex > -1){
                            genes.splice(genes.indexOf(geneToRemove),1) //remove from gene list
                            topList =  topList.filter(function(obj){ //remove from topList
                                return obj.gene != geneToRemove
                            })
                            filteredData = filteredData.filter(function(f){return f.Gene != geneToRemove})
                            //console.log(filteredData)
                            //rerank samples if not locked
                            if(document.getElementById("groupByList").value == 'Sample'){
                                samples = rankSamples(samples, filteredData, metadata, genes)
                            }
                            //console.log(sampleRankList)
                            
                            //redraw positions
                            readjustPos(genes, samples, metaList)
                            d3.selectAll('.' + geneToRemove).remove()
                        }
                    })
            }
            function reSort(groupByValue, sortByValue){
                console.log("grouping by... " + groupByValue + " on... " + sortByValue)
                if(groupByValue == 'Sample'){
                    //sort by default
                    samples = rankSamples(samples,filteredData, metadata, genes)
                    readjustPos(genes, samples, metaList)
                }
                else if(groupByValue == 'Custom'){
                    //do nothing
                }
                else{
                    var metaKey = []
                    metadata.forEach(function(d){metaKey.push({sample: d.Sample, value: d[groupByValue]})})
                    var metaValues = metaKey.map(a => a.value)
                    //check if metadata values are not numerical
                    if(metaValues.some(isNaN)){
                        uniqValues = [...new Set(metaValues)]
                        sampleOrder = []
                        for(i in uniqValues){
                            var groupOrder = []
                            var groupScore = BigInt(0)
                            groupData = metaKey.filter(function(f){
                                return f.value == uniqValues[i]
                            })
                            //console.log(sampleData)
                            for(j in groupData){
                                sampleData = filteredData.filter(function(f){
                                    return f.Sample == groupData[j].sample 
                                })
                                var sampleScore = rankSampleSubset(sampleData,metadata,genes)
                                groupOrder.push({sample: groupData[j].sample , group: uniqValues[i], score: sampleScore})
                                if(sortByValue == 'max'){
                                    if(groupScore < sampleScore){
                                        groupScore = sampleScore
                                    }
                                }
                                else if(sortByValue == 'avg'){
                                    groupScore = groupScore + sampleScore
                                }
                                else{
                                    //should never happpen
                                    console.log("error")
                                }
                            }
                            if(sortByValue == 'avg'){
                                groupScore = groupScore / BigInt(groupData.length)
                            }
                            groupOrder = groupOrder.map(a => ({...a, groupScore: groupScore}))
                            sampleOrder = sampleOrder.concat(groupOrder)
                        }
                        sampleOrder.sort(function(a,b){
                            if(b.groupScore > a.groupScore){
                                return 1
                            }
                            else if(b.groupScore == a.groupScore){
                                //console.log(b.score + ">" + a.score + "?")
                                if(b.score > a.score){
                                    //console.log('true')
                                    return 1
                                }
                                else{
                                    return -1
                                }
                            }
                            else {
                                return -1
                            }
                        })
                        if(splitGroups.property("checked")){
                            var insertIndices = []
                            for(j in sampleOrder){
                                if(j>0){
                                    meta_a = metadata.filter(function(f){return f.Sample == sampleOrder[j-1].sample})[0]
                                    meta_b = metadata.filter(function(f){return f.Sample == sampleOrder[j].sample})[0]
                                    if(meta_a[groupByValue] != meta_b[groupByValue]){
                                        insertIndices.push(j)
                                    }
                                }
                            }
                            for(i = insertIndices.length-1; i >= 0; i--){
                                sampleOrder.splice(insertIndices[i],0," ".repeat(i))
                            }
                        }
                        console.log(sampleOrder)
                        samples = sampleOrder.map(a => a.sample)
                        d3.select('.legend').attr('transform', 'translate(' + ((y(cellWidth) + cellPadding) * (samples.length + 2)+ y(yAxisWidth)) + ",0)" )
                        readjustPos(genes, samples, metaList)
                    }
                    //if metadata values are numerical
                    else{
                        metadata.sort((a, b) => (a[groupByValue] < b[groupByValue]) ? 1 : -1)
                        samples = metadata.map(a => a.Sample)
                    }
                    readjustPos(genes, samples, metaList)
                }
            }
            
            //add x axis
            for (var i in samples){
                xaxis.append('text')
                    .text(samples[i])
                    .attr('id', samples[i] +"_label")
                    .attr('class', samples[i])
                    .attr('x', (y(cellWidth) + cellPadding) * i)
                    .attr('dx',y(yAxisWidth))
                    .attr('dy',y(10))
                    .attr('text-anchor', 'start')
                    .attr('transform','rotate(45,' + ((y(cellWidth) + cellPadding) * i + y(yAxisWidth) )+ ',' + y(10)+ ')')
                    .attr('font-size',scale(xAxistextSize))
            }
            //add y axis
            for (var j in genes){
                addGene(genes[j], j)
            }
            
            //add variants to chart
            addVariants(filteredData,genes,samples,metadata)
            
            //add legend to chart
            var legend = svg.append('g')
                .attr('class','legend')
                .attr('transform', 'translate(' + ((y(cellWidth) + cellPadding) * (samples.length + 2)+ y(yAxisWidth)) + ",0)" )
            
            legend.selectAll('.legendAttrRect')
                .data(attr)
                .enter()
                .append('rect')
                .attr('width',y(cellWidth))
                .attr('height',y(cellHeight/2))
                .attr('fill',function(d){
                    return colorScale(d)
                })
                .attr('y', function(d,i){return (y(cellHeight/2) + (cellPadding*2)) * i})
            
            legend.selectAll('.legendAttrText')
                .data(attr)
                .enter()
                .append('text')
                .text(function(d){return d})
                .attr('font-size',scale(yAxistextSize))
                .attr('x', y(cellWidth) + cellPadding)
                .attr('y', function(d,i){return (y(cellHeight/2) + (cellPadding*2)) * i})
                .attr('dy', scale(yAxistextSize))
            
            //add metadata to chart
            var metaTracks = svg.append('g')
                .attr('class','metadata')
                .attr('transform', function(d){
                    return 'translate(' + y(yAxisWidth) + ',' + ((y(cellHeight) + cellPadding) * genes.length) + ')'
                })
            
            var metaTrack = metaTracks.selectAll('.metadata')
                .data(metadata).enter()
                .append('g')
            
            var metaLegendOffset = (y(cellHeight/2) + (cellPadding*2)) * 7
            for (i in metaList){
                if(metaList[i] != 'Sample'){
                    //generate colorscale for meta value
                    metaColorScale = colorMetadata(metaList[i], metadata)
                    //for each sample, draw squares for each meta value
                    metaTrack.append('rect')
                        .attr('class',function(d){return d.Sample + " COL"})
                        .attr('id', metaList[i])
                        .attr('width',y(cellWidth))
                        .attr('height',y(cellHeight/2))
                        .attr('fill',function(d){
                            return metaColorScale(d[metaList[i]])
                        })
                        .attr('x', function(d){return (y(cellWidth) + cellPadding) * samples.indexOf(d.Sample)})
                        .attr('y', (y(metadataHeight) + cellPadding) * i)
                        .attr('pointer-events', function(d){
                            if (d[this.id] != ''){
                                return 'all'
                            }
                            else {
                                return 'none'
                            }
                        })
                        .on('mouseover', function(d){
                            //console.log(d)
                            div.html(
                                this.id + ': ' + d[this.id]
                            )
                            div.style("left", (d3.event.pageX + 10) + "px")
                            div.style("top", (d3.event.pageY + 15) + "px")
                            div.style('opacity','0.9')
                            div.style('background', 'gray')
                            d3.select(this)
                                .attr('stroke','black')
                                .attr('stroke-width', '2px')
                        })
                        .on('mouseout', function(){
                            d3.select(this)
                                .attr('stroke','none')
                            div.style('opacity','0')
                        })
                    //append label
                    metaTracks.append('text')
                        .text(metaList[i])
                        .attr('dx', x(-20))
                        .attr('dy', y(metadataHeight/2 + 5))
                        .attr('text-anchor', 'end')
                        .attr('y', (y(metadataHeight) + cellPadding) * i)
                        .attr('font-size',scale(yAxistextSize))
                    
                    var metaValues = metadata.map(a => a[metaList[i]])
                    
                    
                    if(!metaValues.some(isNaN)){
                        legend.append('text')
                            .text(metaList[i])
                            .attr('font-size',scale(yAxistextSize))
                            .attr('font-weight', 'bold')
                            .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset})
                            .attr('dy', scale(-5))
                        metaLegendOffset =  (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset
                        
                        legendArray = []
                        for(j=Math.min(...metaValues); j <= Math.max(...metaValues); j = ((Math.max(...metaValues) - Math.min(...metaValues))/5)+j ){
                            legendArray.push(j)
                        }
                         
                        for(j=0; j < 5; j++){
                            legend.append('rect')
                                .attr('width',y(cellWidth))
                                .attr('height',y(cellHeight/2))
                                .attr('fill',function(d){
                                    return metaColorScale(legendArray[j])
                                })
                                .attr('x', function(d){return y(cellWidth) * j})
                                .attr('y', function(d){return metaLegendOffset})    
                        }
                        legend.append('text')
                            .text(Math.min(...metaValues))
                            .attr('font-size',scale(yAxistextSize))
                            .attr('text-anchor', 'middle')
                            .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset})
                            .attr('dy', scale(yAxistextSize)/2)
                        
                        legend.append('text')
                            .text(Math.max(...metaValues))
                            .attr('font-size',scale(yAxistextSize))
                            .attr('text-anchor', 'middle')
                            .attr('x', function(d){return y(cellWidth) * 5})
                            .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset})
                            .attr('dy', scale(yAxistextSize)/2)
                        
                        metaLegendOffset =  (y(cellHeight/2) + (cellPadding*2)) * 2 + metaLegendOffset
                        
                    }
                    else{
                        var uniqValues = [...new Set(metaValues)]
                        if(uniqValues.includes('')){
                            uniqValues.splice(uniqValues.indexOf(''),1)
                        }
                        legend.append('text')
                            .text(metaList[i])
                            .attr('font-size',scale(yAxistextSize))
                            .attr('font-weight', 'bold')
                            .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset})
                            .attr('dy', scale(-5))
                        
                        metaLegendOffset =  (y(cellHeight/2) + (cellPadding*2)) + metaLegendOffset
                        
                        for(j in uniqValues){
                            legend.append('rect')
                                .attr('width',y(cellWidth))
                                .attr('height',y(cellHeight/2))
                                .attr('fill',function(d){
                                    return metaColorScale(uniqValues[j])
                                })
                                .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) * j + metaLegendOffset})

                            legend.append('text')
                                .text(uniqValues[j])
                                .attr('font-size',scale(yAxistextSize))
                                .attr('x', y(cellWidth) + cellPadding)
                                .attr('y', function(d){return (y(cellHeight/2) + (cellPadding*2)) * j + metaLegendOffset})
                                .attr('dy', scale(yAxistextSize))
                        }
                        metaLegendOffset =  (y(cellHeight/2) + (cellPadding*2)) * (uniqValues.length + 1) + metaLegendOffset
                    }
                }
                groupBy.append('option')
                    .attr('value',metaList[i])
                    .text(metaList[i])
            }
            groupBy.append('option')
                .attr('value', 'Custom')
                .text('Custom')
            
            //add gene code
            var addGeneList = d3.select('#addGeneList')
            var addGeneInput = d3.select('#addGeneInput')
            var addGeneButton = d3.select('#addGeneButton')
            var removeAllButton = d3.select('#removeAllButton')
            /*
            addGeneInput.on("keyup", function(d){
                addGeneList.html(null) //remove old list
                geneStartsWith = geneList.filter((gene) => gene.startsWith(this.value))

                if(geneStartsWith.length == 0){
                    d3.select('#no_variants_error').style('opacity',1)
                }
                else if(geneStartsWith.length <= 20){ //if list less than 20, show list
                    d3.select('#no_variants_error').style('opacity',0)
                    for(var i in geneStartsWith){
                        addGeneList.append('option')
                            .text(geneStartsWith[i])
                    }
                }
                else{
                    d3.select('#no_variants_error').style('opacity',0)
                }
            })
            */
            removeAllButton.on('click', function(d){
                for(i in genes){
                    d3.selectAll('.' + genes[i]).remove()
                }
                genes = []
                topList = []
                filteredData = []
                readjustPos(genes, samples, metaList)
            })

            addGeneButton.on('click', function(d){
                geneToAdd = document.getElementById("addGeneInput").value
                document.getElementById("addGeneInput").value = ""

                if(geneToAdd.includes(",") || geneToAdd.includes("\n")){
                    genesToAdd = geneToAdd.split(/[\n,]/)
                }
                else{
                    genesToAdd = [geneToAdd]
                }
                genesToAdd = genesToAdd.map(a=>a.trim())

                for(g in genesToAdd){
                    if(geneList.includes(genesToAdd[g]) && !genes.includes(genesToAdd[g])){
                        console.log("Adding " + genesToAdd[g])
                        geneData = data.filter(function(f){
                            return f.Gene == genesToAdd[g]
                        })
                        geneRank = {gene: genesToAdd[g], score: rankGeneSubset(geneData,metadata)}
                        //add to toplist
                        topList.push(geneRank)
                        topList.sort(function(a,b){return b.score - a.score})
                        //add to genelist
                        console.log(topList)
                        genes = topList.map(a => a.gene)
                        //get filteredData again
                        filteredData = []
                        for(i in topList){
                            filteredData = filteredData.concat(data.filter(function(f){return f.Gene == topList[i].gene}))
                        }
                        //rerank samples
                        if(document.getElementById("groupByList").value == 'Sample'){
                            samples = rankSamples(samples,filteredData, metadata, genes)
                        }
                        //add gene to yaxis
                        addGene(genesToAdd[g], genes.length)
                        //add variants
                        addVariants(geneData, genes, samples, metadata)
                        //redraw positions
                        readjustPos(genes, samples, metaList)
                    }
                    else{
                        console.log("Gene missing or already in oncoprint")
                        d3.select('#no_variants_error').style('opacity',1)
                    }
                }
                
            })

            toggleFocal.on('click', function(d){
                console.log('toggle focal')
                isFocal = !isFocal
                topList = rankGenes(filteredData, genes, metadata)
                genes = topList.map(a => a.gene)
                if(document.getElementById("groupByList").value == 'Sample'){
                    samples = rankSamples(samples,filteredData, metadata, genes)
                }
                d3.selectAll('.CNV')
                    .attr('fill',function(d){
                        /*
                        if(metadata.filter(function(f){return f.Sample == d.Sample})[0].Gender == 'male' && chrXY_geneList.includes(d.Gene) ){
                            console.log('MALE! ' + d.Gene + " " + d.CNV + " " + ploidy)
                            var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy) /2
                        }
                        else{
                            var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy * 2) /2
                        }*/
                        return getCNVColor(d)
                    })
                readjustPos(genes, samples, metaList)
            })
            
            //readjust threshold code 
            var readjustThreshold = d3.select('#readjustThreshold')
            
            //on click of button
            readjustThreshold.on('click',function(d){
                console.log("Readjusting thresholds...")
                thresh_highamp = document.getElementById("high_amp_adjust").value
                thresh_amp = document.getElementById("amp_adjust").value
                thresh_del = document.getElementById("del_adjust").value
                thresh_deepdel = document.getElementById("deep_del_adjust").value
                //rerank current genes
                console.log("Ranking Genes...")
                topList = rankGenes(filteredData, genes, metadata)
                //reorder genes in list
                genes = topList.map(a => a.gene)
                //rerank samples
                if(document.getElementById("groupByList").value == 'Sample'){
                    samples = rankSamples(samples,filteredData, metadata, genes)
                }
                //recolor cnvs of current genes
                d3.selectAll('.CNV')
                    .attr('fill',function(d){
                        /*
                        if(metadata.filter(function(f){return f.Sample == d.Sample})[0].Gender == 'male' && chrXY_geneList.includes(d.Gene) ){
                            console.log('MALE! ' + d.Gene + " " + d.CNV + " " + ploidy)
                            var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy) /2
                        }
                        else{
                            var ploidy = Math.round(metadata.filter(function(f){return f.Sample == d.Sample})[0].Ploidy * 2) /2
                        }*/
                        return getCNVColor(d)
                    })
                readjustPos(genes, samples, metaList)
            })
            rankBy.on('change',function(d){
                var rankByValue = this.value
                var groupByValue = document.getElementById('groupByList').value
                console.log("Ranking Genes...")
                if(this.value == "All"){
                    topList = rankGenes(filteredData, genes, metadata)
                }
                else{
                    sampleList = metadata.filter(function(f){return f[groupByValue] == rankByValue}).map(function(d){return d["Sample"]})
                    console.log(sampleList)
                    subsetData = []
                    for(i in sampleList){
                        subsetData = subsetData.concat(filteredData.filter(function(f){return f.Sample == sampleList[i]}))
                    }
                    topList = rankGenes(subsetData, genes, metadata)
                }
                //reorder genes in list
                genes = topList.map(a => a.gene)
                //rerank samples
                //if(document.getElementById("groupByList").value == 'Sample'){
                //    samples = rankSamples(samples,filteredData, metadata, genes)
                //}
                //recolor cnvs of current genes
                d3.selectAll('.CNV')
                    .attr('fill',function(d){
                        return getCNVColor(d)
                    })
                readjustPos(genes, samples, metaList)
            })
            //groupBy code
            groupBy.on('change',function(d){
                var value = this.value
                reSort(value, document.getElementById('sortByList').value)
                var uniqSubgroups = metadata.map(function (el) {return el[value]; })
                uniqSubgroups = [...new Set(uniqSubgroups)]
                rankBy.html(null)
                rankBy.append('option')
                        .attr('value',"All")
                        .text("All")
                for(i in uniqSubgroups){
                    rankBy.append('option')
                        .attr('value',uniqSubgroups[i])
                        .text(uniqSubgroups[i])
                }
            })
            sortBy.on('change',function(d){
                reSort(document.getElementById('groupByList').value, this.value )
            })

            //splitGroups code
            splitGroups.on('change',function(d){
                reSort(document.getElementById('groupByList').value, document.getElementById('sortByList').value)
            })
            
            function cPosition(d) {
                var v = dragging[d.sample];
                return v == null ? d.x : v;
            }
            var dragging = []
            var draggedSample
            var positions = []
            
            //drag behavior code
            d3.selectAll(".COL")
                .call(d3.drag()
                .subject(function() { 
                    var t = d3.select(this);
                    return {sample: t.attr("class").split(" ")[0], x: t.attr("x")};
                })
                .on("start", function(d) {
                    console.log('drag started')
                    draggedSample = d3.event.subject.sample
                    for(i in samples){
                        positions.push({sample: samples[i], x: (y(cellWidth) + cellPadding) * i})
                    }

                })
                .on("drag", function(d) {
                    d3.selectAll("." + draggedSample).attr("x", d3.event.x)
                    d3.selectAll('#' + draggedSample + "_label")
                        .attr('transform','rotate(45,' + (d3.event.x + y(yAxisWidth) )+ ',' + y(10)+ ')')
                    dragging[draggedSample] = d3.event.x
                    dragsamples = positions.sort(function(a,b){ return cPosition(a) - cPosition(b)}).map(a => a.sample)
                    if(!arraysEqual(samples, dragsamples)){
                        //change groupBy value to Custom
                        groupBy.property('value','Custom')
                        //resort based on new order
                        samples = dragsamples 
                        readjustPos(genes, samples, metaList)
                    }
                })
                .on("end", function(d) {
                    console.log('drag ended')
                    positions = []
                    delete dragging[draggedSample]
                    readjustPos(genes, samples, metaList)
                })  
            )

            var groupByDesc = d3.select('#groupByDesc')
            var rankByDesc = d3.select('#rankByDesc')
            var sortByDesc = d3.select('#sortByDesc')

            groupByDesc.on('mouseover', function(d){
                //console.log(d)
                div.html(
                    "Group samples into subgroups by metadata"
                )
                div.style("left", (d3.event.pageX + 10) + "px")
                div.style("top", (d3.event.pageY + 15) + "px")
                div.style('opacity','0.9')
                })
                .on('mouseout', function(){
                    d3.select(this)
                        .attr('stroke','none')
                    div.style('opacity','0')
                })
            
            rankByDesc.on('mouseover', function(d){
                //console.log(d)
                div.html(
                    "Order genes only using specific subgroup's samples"
                )
                div.style("left", (d3.event.pageX + 10) + "px")
                div.style("top", (d3.event.pageY + 15) + "px")
                div.style('opacity','0.9')
                })
                .on('mouseout', function(){
                    d3.select(this)
                        .attr('stroke','none')
                    div.style('opacity','0')
                })

            sortByDesc.on('mouseover', function(d){
                //console.log(d)
                div.html(
                    "Order subgroups by samples with max score or average score"
                )
                div.style("left", (d3.event.pageX + 10) + "px")
                div.style("top", (d3.event.pageY + 15) + "px")
                div.style('opacity','0.9')
                })
                .on('mouseout', function(){
                    d3.select(this)
                        .attr('stroke','none')
                    div.style('opacity','0')
                })
            
        })
    </script>
  </body>
</html>
